<div id="checkout-popup" style="
  display: none;
  position: fixed;
  top: 0; 
  left: 0;
  width: 100vw; 
  height: 100vh;
  background: rgba(0,0,0,0.5);
  z-index: 9999;
  font-family: Inter,sans-serif;
  overflow: auto;
  box-sizing: border-box;
  align-items: center;
  justify-content: center;
">
  <div style="background:#fff;padding:32px;border-radius:20px;max-width:520px;width:95vw;margin:auto;text-align:left;box-shadow:0 20px 60px rgba(0,0,0,0.15);position:relative;display:flex;flex-direction:column;max-height:90vh;overflow-y:auto;">
    <button id="close-popup" style="
      position: absolute;
      top: 20px;
      right: 20px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      font-size: 20px;
      color: #6c757d;
      cursor: pointer;
      z-index: 10001;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
      font-weight: bold;
    " onmouseover="this.style.background='#e9ecef'; this.style.color='#495057';" onmouseout="this.style.background='#f8f9fa'; this.style.color='#6c757d';">&times;</button>
    
    <h2 style="margin-bottom:24px;font-size:1.5em;color:#1a202c;font-weight:700;text-align:center;">Complete Your Purchase</h2>
    
   <!-- ONE TIME OFFER BANNER -->
<div id="oto-offer" style="background:linear-gradient(135deg,#667eea 0%, #764ba2 100%);border-radius:16px;padding:20px;margin-bottom:24px;box-shadow:0 4px 20px rgba(102,126,234,0.3);color:white;text-align:center;">
  <div style="display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:12px;">
    <span style="font-size:1.5em;"><i class="fa fa-bolt"></i></span>
    <span style="background:rgba(255,255,255,0.2);padding:6px 16px;border-radius:20px;font-weight:700;font-size:0.9em;letter-spacing:0.5px;">LIMITED TIME OFFER</span>
  </div>
  <div style="font-size:1.1em;font-weight:600;margin-bottom:8px;">Get your full AI report for only <span style="color:#ffd700;font-weight:800;">â‚¬10</span> (~$11.34)</div>
  <div style="font-size:0.9em;opacity:0.9;">Use coupon <span style="color:#ffd700;font-weight:700;">TRY10</span> â€¢ Time left: <span id="oto-timer" style="font-weight:700;">05:00</span></div>
</div>

    <!-- Product Info -->
    <div style="margin-bottom:20px;padding:16px;background:#f8f9fa;border-radius:12px;">
      <div style="font-size:0.9em;color:#6c757d;margin-bottom:4px;">Product</div>
      <div style="font-weight:600;color:#1a202c;margin-bottom:8px;">AI Landing Page Analysis Report</div>
      <div id="checkout-url" style="font-size:0.85em;color:#6c757d;word-break:break-all;"></div>
    </div>

    <!-- Pricing -->
    <div style="margin-bottom:20px;text-align:center;">
      <div style="font-size:2em;font-weight:700;color:#1a202c;">
        <span id="checkout-eur">â‚¬20.00</span>
        <span id="checkout-usd" style="font-size:0.6em;color:#6c757d;font-weight:400;margin-left:8px;">(~$22.68)</span>
      </div>
    </div>

    <!-- Coupon -->
    <div style="margin-bottom:24px;">
      <label style="font-size:0.9em;color:#4a5568;font-weight:500;display:block;margin-bottom:8px;">Promo Code</label>
      <div style="display:flex;gap:12px;">
        <input id="coupon-input" type="text" placeholder="Enter coupon code" style="flex:1;padding:12px 16px;border:2px solid #e2e8f0;border-radius:10px;font-size:1em;transition:border-color 0.2s;" onfocus="this.style.borderColor='#667eea';" onblur="this.style.borderColor='#e2e8f0';">
        <button id="apply-coupon" type="button" style="padding:12px 20px;background:#667eea;color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:600;transition:background 0.2s;" onmouseover="this.style.background='#5a6fd8';" onmouseout="this.style.background='#667eea';">Apply</button>
      </div>
      <div id="coupon-msg" style="font-size:0.9em;margin-top:8px;display:none;"></div>
    </div>


        <!-- Payment Methods -->
    <div id="payment-section">
      <!-- Payment Method Switcher -->
      <div style="margin-bottom:20px;">
        <div style="display:flex;background:#f1f5f9;border-radius:12px;padding:4px;margin-bottom:16px;">
          <button id="stripe-tab" class="payment-tab active" style="flex:1;padding:12px;border:none;background:white;border-radius:8px;font-weight:600;color:#1a202c;cursor:pointer;transition:all 0.2s;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
            <i class="fa fa-credit-card" style="margin-right:8px;"></i>Card
          </button>
          <button id="paypal-tab" class="payment-tab" style="flex:1;padding:12px;border:none;background:transparent;border-radius:8px;font-weight:600;color:#64748b;cursor:pointer;transition:all 0.2s;">
            <i class="fab fa-paypal" style="margin-right:8px;"></i>PayPal
          </button>
        </div>
      </div>

      <!-- Stripe Payment Form (Default) -->
      <div id="stripe-payment" class="payment-method active">
        <div id="stripe-card-element" style="padding:16px;border:2px solid #e2e8f0;border-radius:10px;background:white;margin-bottom:16px;"></div>
        
        <!-- ðŸŽ¯ BILLING SECTION QUI SOTTO LA CARTA -->
        <div id="billing-section" style="display:none;margin-bottom:16px;opacity:0;transition:all 0.5s ease-in-out;">
          <h3 style="font-size:1.1em;color:#1a202c;margin-bottom:16px;font-weight:600;">
            <i class="fa fa-user" style="margin-right:8px;color:#667eea;"></i>Billing Information
          </h3>
          
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:14px;">
            <div>
              <label style="font-size:0.9em;color:#4a5568;font-weight:500;display:block;margin-bottom:6px;">First Name *</label>
              <input id="billing-first-name" type="text" required style="width:100%;padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:0.95em;transition:border-color 0.2s;box-sizing:border-box;" onfocus="this.style.borderColor='#667eea';" onblur="this.style.borderColor='#e2e8f0';">
            </div>
            <div>
              <label style="font-size:0.9em;color:#4a5568;font-weight:500;display:block;margin-bottom:6px;">Last Name *</label>
              <input id="billing-last-name" type="text" required style="width:100%;padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:0.95em;transition:border-color 0.2s;box-sizing:border-box;" onfocus="this.style.borderColor='#667eea';" onblur="this.style.borderColor='#e2e8f0';">
            </div>
          </div>
          
          <div style="margin-bottom:14px;">
            <label style="font-size:0.9em;color:#4a5568;font-weight:500;display:block;margin-bottom:6px;">Email Address *</label>
            <input id="billing-email" type="email" required style="width:100%;padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:0.95em;transition:border-color 0.2s;box-sizing:border-box;" onfocus="this.style.borderColor='#667eea';" onblur="this.style.borderColor='#e2e8f0';">
          </div>
          
          <div style="margin-bottom:14px;">
            <label style="font-size:0.9em;color:#4a5568;font-weight:500;display:block;margin-bottom:6px;">Company (Optional)</label>
            <input id="billing-company" type="text" style="width:100%;padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:0.95em;transition:border-color 0.2s;box-sizing:border-box;" onfocus="this.style.borderColor='#667eea';" onblur="this.style.borderColor='#e2e8f0';">
          </div>
          
          <div style="margin-bottom:14px;">
            <label style="font-size:0.9em;color:#4a5568;font-weight:500;display:block;margin-bottom:6px;">Address Line 1 *</label>
            <input id="billing-address" type="text" required style="width:100%;padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:0.95em;transition:border-color 0.2s;box-sizing:border-box;" onfocus="this.style.borderColor='#667eea';" onblur="this.style.borderColor='#e2e8f0';" placeholder="Street address">
          </div>
          
          <div style="display:grid;grid-template-columns:2fr 1fr;gap:16px;margin-bottom:14px;">
            <div>
              <label style="font-size:0.9em;color:#4a5568;font-weight:500;display:block;margin-bottom:6px;">City *</label>
              <input id="billing-city" type="text" required style="width:100%;padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:0.95em;transition:border-color 0.2s;box-sizing:border-box;" onfocus="this.style.borderColor='#667eea';" onblur="this.style.borderColor='#e2e8f0';">
            </div>
            <div>
              <label style="font-size:0.9em;color:#4a5568;font-weight:500;display:block;margin-bottom:6px;">ZIP/Postal Code *</label>
              <input id="billing-postal" type="text" required style="width:100%;padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:0.95em;transition:border-color 0.2s;box-sizing:border-box;" onfocus="this.style.borderColor='#667eea';" onblur="this.style.borderColor='#e2e8f0';" placeholder="12345">
            </div>
          </div>
          
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:14px;">
            <div>
              <label style="font-size:0.9em;color:#4a5568;font-weight:500;display:block;margin-bottom:6px;">Country *</label>
              <input id="billing-country" type="text" required style="width:100%;padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:0.95em;transition:border-color 0.2s;box-sizing:border-box;" onfocus="this.style.borderColor='#667eea';" onblur="this.style.borderColor='#e2e8f0';" placeholder="e.g., United States, Italy, Germany">
            </div>
            <div>
              <label style="font-size:0.9em;color:#4a5568;font-weight:500;display:block;margin-bottom:6px;">State/Province</label>
              <input id="billing-state" type="text" style="width:100%;padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:0.95em;transition:border-color 0.2s;box-sizing:border-box;" onfocus="this.style.borderColor='#667eea';" onblur="this.style.borderColor='#e2e8f0';" placeholder="Optional">
            </div>
          </div>
          
          <div style="margin-bottom:14px;">
            <label style="font-size:0.9em;color:#4a5568;font-weight:500;display:block;margin-bottom:6px;">Phone Number (Optional)</label>
            <input id="billing-phone" type="tel" style="width:100%;padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:0.95em;transition:border-color 0.2s;box-sizing:border-box;" onfocus="this.style.borderColor='#667eea';" onblur="this.style.borderColor='#e2e8f0';" placeholder="+1 234 567 8900">
          </div>
        </div>
        
        <button id="stripe-submit" type="button" style="width:100%;padding:16px;background:linear-gradient(135deg,#667eea 0%, #764ba2 100%);color:white;border:none;border-radius:12px;font-size:1.1em;font-weight:600;cursor:pointer;transition:all 0.2s;box-shadow:0 4px 12px rgba(102,126,234,0.3);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 16px rgba(102,126,234,0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(102,126,234,0.3)';">
          <span id="stripe-submit-text">Complete Payment</span>
        </button>
      </div>

      <!-- PayPal Payment -->
      <div id="paypal-payment" class="payment-method" style="display:none;">
        <div id="paypal-button-container" style="min-height:48px;"></div>
      </div>
    </div>

    <!-- Free Unlock Button - MOVED OUTSIDE payment-section -->
    <button id="unlock-free-btn" type="button" style="display:none;width:100%;padding:16px;background:linear-gradient(135deg,#48bb78 0%, #38a169 100%);color:white;border:none;border-radius:12px;font-size:1.1em;font-weight:600;cursor:pointer;transition:all 0.2s;box-shadow:0 4px 12px rgba(72,187,120,0.3);margin-top:20px;" onmouseover="this.style.transform='translateY(-1px)';" onmouseout="this.style.transform='translateY(0)';">
      <i class="fa fa-unlock" style="margin-right:8px;"></i>Unlock Report Free
    </button>

    <div style="margin-top:20px;text-align:center;color:#6c757d;font-size:0.85em;">
      <div style="display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:8px;">
        <i class="fa fa-shield-alt"></i>
        <span>Secure payment powered by Stripe & PayPal</span>
      </div>
      <div style="font-size:0.8em;opacity:0.8;">Your payment information is encrypted and secure</div>
    </div>
  </div>
</div>

<!-- Payment Success Modal -->
<div id="payment-success-modal" style="
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.8);
  z-index: 10000;
  font-family: Inter, sans-serif;
  align-items: center;
  justify-content: center;
">
  <div style="
    background: white;
    padding: 40px;
    border-radius: 20px;
    max-width: 500px;
    width: 90vw;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    animation: successPop 0.5s ease-out;
  ">
    <div style="
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #48bb78, #38a169);
      border-radius: 50%;
      margin: 0 auto 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: checkmark 0.6s ease-out 0.2s both;
    ">
      <i class="fa fa-check" style="font-size: 36px; color: white;"></i>
    </div>
    
    <h2 style="
      color: #1a202c;
      font-size: 1.8em;
      font-weight: 700;
      margin-bottom: 16px;
    ">Payment Successful! ðŸŽ‰</h2>
    
    <p style="
      color: #4a5568;
      font-size: 1.1em;
      margin-bottom: 24px;
      line-height: 1.5;
    ">Your LandingFix AI report has been unlocked successfully.<br>You now have access to all optimization insights!</p>
    
    <div id="payment-details" style="
      background: #f7fafc;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 24px;
      text-align: left;
    ">
      <div style="font-weight: 600; color: #1a202c; margin-bottom: 8px;">Payment Details:</div>
      <div id="payment-info" style="font-size: 0.9em; color: #4a5568;"></div>
    </div>
    
        <div style="display: flex; gap: 12px; justify-content: center;">
      <button id="view-report-btn" style="
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 16px 32px;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 1.1em;
      ">
        <i class="fa fa-eye" style="margin-right: 10px;"></i>View Your Report
      </button>
    </div>
  </div>
</div>

<style>
/* === PAYMENT TABS === */
.payment-tab.active {
  background: white !important;
  color: #1a202c !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.payment-method {
  display: none;
}

.payment-method.active {
  display: block;
}

/* === STRIPE CARD ELEMENT === */
#stripe-card-element {
  transition: border-color 0.2s;
}

#stripe-card-element:focus-within {
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
}

/* === BILLING SECTION === */
#billing-section {
  transform: translateY(-20px);
  transition: all 0.5s ease-in-out;
}

/* Enhanced billing field styles */
#billing-section input:focus,
#billing-section select:focus {
  border-color: #667eea !important;
  box-shadow: 0 0 0 3px rgba(102,126,234,0.1) !important;
  outline: none;
}

#billing-section input.error,
#billing-section select.error {
  border-color: #e53e3e !important;
  box-shadow: 0 0 0 3px rgba(229,62,62,0.1) !important;
}

/* === ANIMATIONS === */
@keyframes slideInFromTop {
  0% { transform: translateY(-20px); opacity: 0; }
  100% { transform: translateY(0); opacity: 1; }
}

@keyframes slideOutToTop {
  0% { transform: translateY(0); opacity: 1; }
  100% { transform: translateY(-20px); opacity: 0; }
}

@keyframes successPop {
  0% { transform: scale(0.5); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes checkmark {
  0% { transform: scale(0); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

@keyframes errorSlideIn {
  0% { transform: translateY(-20px); opacity: 0; }
  100% { transform: translateY(0); opacity: 1; }
}

@keyframes errorSlideOut {
  0% { transform: translateY(0); opacity: 1; }
  100% { transform: translateY(-20px); opacity: 0; }
}

/* === BUTTONS === */
#payment-success-modal button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

button:hover {
  transform: translateY(-1px);
}

/* === RESPONSIVE === */
@media (max-width: 640px) {
  #billing-section div[style*="grid-template-columns"] {
    display: block !important;
  }
  
  #billing-section div[style*="grid-template-columns"] > div {
    margin-bottom: 14px;
  }
  
  #billing-section div[style*="grid-template-columns"] > div:last-child {
    margin-bottom: 0;
  }
}
</style>