<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LandingFix AI â€“ Your Landing Page Report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="images/favicon.png">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="report.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-N428QVWSBX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-N428QVWSBX');
  </script>
  <!-- Meta Pixel Code -->
  <script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '979745484240414');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=979745484240414&ev=PageView&noscript=1"
  /></noscript>
  <!-- End Meta Pixel Code -->
  <!-- Cookie Banner -->
  <script type="text/javascript">
  var _iub = _iub || [];
  _iub.csConfiguration = {"siteId":4047297,"cookiePolicyId":80028888,"lang":"en","storage":{"useSiteId":true}};
  </script>
  <script type="text/javascript" src="https://cs.iubenda.com/autoblocking/4047297.js"></script>
  <script type="text/javascript" src="//cdn.iubenda.com/cs/gpp/stub.js"></script>
  <script type="text/javascript" src="//cdn.iubenda.com/cs/iubenda_cs.js" charset="UTF-8" async></script>
  <!-- End Cookie Banner -->
</head>
<body>
<div id="main-header"></div>
<script src="script.js"></script>
<script>
fetch('header.html')
  .then(res => res.text())
  .then(html => {
    document.getElementById('main-header').innerHTML = html;
    setupHamburgerMenu();
  });
</script>

<main>
  <div class="container">
    <h2 class="report-title">Landing Page Analysis Report</h2>
    <div id="dynamic-report-details"></div>
    <div id="report-content">
      <!-- FIXED: Ensure all 4 category divs exist with proper structure -->
      <div class="report-category" id="category-0">
        <div class="category-header">
          <h3 class="category-title">
            <span class="category-name">Loading...</span>
            <span class="category-metrics">
              <span class="metric"><i class="fa fa-gauge-high"></i> <span class="cat-score">â€“</span>%</span>
              <span class="metric" style="color:#27ae60;"><i class="fa fa-arrow-up-right-dots"></i> +<span class="cat-impact">â€“</span>%</span>
              <span class="metric"><i class="fa fa-clock"></i> <span class="cat-timing">â€“</span></span>
            </span>
          </h3>
        </div>
        <div class="category-elements">
          <div style="padding: 20px; text-align: center; color: #666;">Loading elements...</div>
        </div>
      </div>

      <div class="report-category locked" id="category-1">
        <div class="category-header">
          <h3 class="category-title">
            <span class="category-name">Loading...</span>
            <span class="category-metrics">
              <span class="metric"><i class="fa fa-gauge-high"></i> <span class="cat-score">â€“</span>%</span>
              <span class="metric" style="color:#27ae60;"><i class="fa fa-arrow-up-right-dots"></i> +<span class="cat-impact">â€“</span>%</span>
              <span class="metric"><i class="fa fa-clock"></i> <span class="cat-timing">â€“</span></span>
            </span>
          </h3>
        </div>
        <div class="category-elements">
          <div style="padding: 20px; text-align: center; color: #666;">Locked - unlock to view</div>
        </div>
      </div>

      <div class="report-category locked" id="category-2">
        <div class="category-header">
          <h3 class="category-title">
            <span class="category-name">Loading...</span>
            <span class="category-metrics">
              <span class="metric"><i class="fa fa-gauge-high"></i> <span class="cat-score">â€“</span>%</span>
              <span class="metric" style="color:#27ae60;"><i class="fa fa-arrow-up-right-dots"></i> +<span class="cat-impact">â€“</span>%</span>
              <span class="metric"><i class="fa fa-clock"></i> <span class="cat-timing">â€“</span></span>
            </span>
          </h3>
        </div>
        <div class="category-elements">
          <div style="padding: 20px; text-align: center; color: #666;">Locked - unlock to view</div>
        </div>
      </div>

      <div class="report-category locked" id="category-3">
        <div class="category-header">
          <h3 class="category-title">
            <span class="category-name">Loading...</span>
            <span class="category-metrics">
              <span class="metric"><i class="fa fa-gauge-high"></i> <span class="cat-score">â€“</span>%</span>
              <span class="metric" style="color:#27ae60;"><i class="fa fa-arrow-up-right-dots"></i> +<span class="cat-impact">â€“</span>%</span>
              <span class="metric"><i class="fa fa-clock"></i> <span class="cat-timing">â€“</span></span>
            </span>
          </h3>
        </div>
        <div class="category-elements">
          <div style="padding: 20px; text-align: center; color: #666;">Locked - unlock to view</div>
        </div>
      </div>

      <!-- Final summary section -->
      <div class="report-summary-final">
        <div class="final-metrics">
          <span class="metric"><i class="fa fa-gauge-high"></i> <span id="final-score">â€“</span>%</span>
          <span class="metric" style="color:#27ae60;"><i class="fa fa-arrow-up-right-dots"></i> +<span id="final-impact">â€“</span>%</span>
          <span class="metric"><i class="fa fa-clock"></i> <span id="final-timing">â€“</span></span>
        </div>
        <div class="legend">
          <span><i class="fa fa-gauge-high"></i> Current Optimization (%)</span>
          <span><i class="fa fa-arrow-up-right-dots"></i> Improvement Potential (%)</span>
          <span><i class="fa fa-clock"></i> Implementation Time</span>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Footer Include -->
<div id="main-footer"></div>
<script>
fetch('footer.html')
  .then(res => res.text())
  .then(html => { document.getElementById('main-footer').innerHTML = html; });
</script>

<!-- Load dependencies FIRST before other scripts -->
<script src="report-utils.js"></script>
<script src="report-builder.js"></script>

<!-- Load the checkout functionality -->
<script src="checkout.js"></script>

<!-- Load the email functionality -->
<script>
// Preload email system
const emailScript = document.createElement('script');
emailScript.src = 'report-mail.js';
emailScript.async = true;
document.head.appendChild(emailScript);
</script>

<!-- Load the PDF functionality -->
<script>
// Preload PDF system
const pdfScript = document.createElement('script');
pdfScript.src = 'report-pdf.js';
pdfScript.async = true;
document.head.appendChild(pdfScript);
</script>

<!-- Load the progressive loading system LAST -->
<script src="load.js"></script>

<!-- Define loadCheckoutPopup function globally - ENHANCED -->
<script>
// Enhanced loadCheckoutPopup with better error handling
window.loadCheckoutPopup = function(callback) {
  console.log('ðŸ”„ loadCheckoutPopup called');
  
  if (document.getElementById('checkout-popup')) {
    console.log('âœ… Checkout popup already exists');
    if (callback) callback();
    return;
  }
  
  console.log('ðŸ“¥ Loading checkout popup...');
  
  fetch('checkout.html')
    .then(res => {
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.text();
    })
    .then(html => {
      document.body.insertAdjacentHTML('beforeend', html);
      console.log('âœ… Checkout popup HTML loaded');
      
      // Small delay to ensure DOM is ready
      setTimeout(() => {
        if (callback) callback();
      }, 100);
    })
    .catch(err => {
      console.error('âŒ Failed to load checkout popup:', err);
      alert('Unable to load checkout system. Please refresh the page and try again.');
    });
};

// FIXED: Add global unlock status monitoring
window.addEventListener('storage', function(e) {
  if (e.key === 'landingfix_unlocked' && e.newValue === 'true') {
    console.log('ðŸ”“ Global unlock detected - updating UI');
    
    // Hide all unlock buttons
    const unlockBtns = document.querySelectorAll('#unlock-full-report, .summary-action-btn.primary, .unlock-btn');
    unlockBtns.forEach(btn => {
      if (btn.textContent.includes('Unlock') || btn.innerHTML.includes('unlock')) {
        btn.style.display = 'none';
        console.log('ðŸ”“ Hiding unlock button:', btn.id || btn.className);
      }
    });
    
    // Force refresh of final summary if it exists
    setTimeout(() => {
      const event = new CustomEvent('unlockStatusChanged', { detail: { isUnlocked: true } });
      window.dispatchEvent(event);
    }, 500);
  }
});

// Add page load debug with enhanced logging
document.addEventListener('DOMContentLoaded', function() {
  console.log('ðŸ“‹ Report.html DOMContentLoaded');
  console.log('ðŸ” Available functions:', {
    loadCheckoutPopup: typeof window.loadCheckoutPopup,
    openCheckout: typeof window.openCheckout,
    unlockFullReport: typeof window.unlockFullReport,
    showEmailPopup: typeof window.showEmailPopup,
    showPdfPopup: typeof window.showPdfPopup
  });
  
  // Check if buttons exist in DOM
  console.log('ðŸ” Button elements check:', {
    unlockBtn: !!document.getElementById('unlock-full-report'),
    emailBtn: !!document.getElementById('send-via-email'),
    pdfBtn: !!document.getElementById('save-as-pdf')
  });
  
  // FIXED: Listen for unlock status changes
  window.addEventListener('unlockStatusChanged', function(e) {
    console.log('ðŸ”“ Unlock status changed event received:', e.detail);
    
    // Trigger report builder to update final summary
    if (window.ReportLoader && window.ReportLoader.reportBuilder) {
      setTimeout(() => {
        const currentScores = {
          optimization: document.getElementById('final-score')?.textContent || 'â€“',
          impact: document.getElementById('final-impact')?.textContent?.replace('+', '') || 'â€“',
          timing: document.getElementById('final-timing')?.textContent || 'â€“'
        };
        window.ReportLoader.reportBuilder.updateFinalSummary(currentScores);
      }, 100);
    }
  });
});
</script>
</body>
</html>